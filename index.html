<!DOCTYPE html>
<!-- https://github.com/JPrevots/Prompt-Builder-for-Deforum -->
<html>

<head>
    <meta charset="utf-8">
    <title>Prompt Builder for Deforum webUI</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="./css/bootstrap-unlit.css">

    <link rel="stylesheet" href="./css/bootstrap-icons/bootstrap-icons.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"> -->
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <!-- NavBar -->
    <nav class="pt-3 container-fluid" style="max-width: 900px;">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <div class="navbar-brand pb-3">Prompt Builder for Deforum webUI</div>
                <div class="collapse navbar-collapse">
                    <ul id="my-ul" class="ms-auto navbar-nav">
                        <li class="nav-item d-none">
                            <a class="nav-link active" onclick="mainContentHandler('promptView')">Prompt</a>
                        </li>
                        <li class="nav-item d-none">
                            <a class="nav-link" onclick="mainContentHandler('motionView')">Motion</a>
                        </li>
                        <li class="nav-item d-none">
                            <a class="nav-link" onclick="mainContentHandler('settingsView')">Settings</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-lg bi-github" href="https://github.com/JPrevots/Prompt-Builder-for-Deforum" target="_blank"></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </nav>

    <!-- Settings View -->
    <div class="view container-fluid d-none" id="settingsView" style="max-width: 900px;">
        <!-- First Row -->
        <div class="my-2 row px-2">
            <!-- Project Name -->
            <div class="col">
                <div class="form-floating">
                    <input type="text" class="form-control" id="projectName" placeholder="" value="Deforum">
                    <label>Project name</label>
                </div>
            </div>
            <!-- Filename format -->
            <div class="col">
                <div class="form-floating">
                    <input type="text" class="form-control" id="filename_format" placeholder="" value="{timestring}_{index}_{prompt}.png">
                    <label>Filename format</label>
                </div>
            </div>
            <!-- Sampler -->
            <div class="col-4">
                <div class="form-floating mb-3">
                    <select class="form-select" id="sampler">
                        <option value="Euler a" selected>Euler a</option>
                        <option value="Euler">Euler</option>
                        <option value="LMS">LMS</option>
                        <option value="Heun">Heun</option>
                        <option value="DPM2">DPM2</option>
                        <option value="DPM2 a">DPM2 a</option>
                        <option value="DPM++ 2S a">DPM++ 2S a</option>
                        <option value="DPM++ 2M">DPM++ 2M</option>
                        <option value="DPM++ SDE">DPM++ SDE</option>
                        <option value="DPM fast">DPM fast</option>
                        <option value="DPM Adaptive">DPM Adaptive</option>
                        <option value="LMS Karras">LMS Karras</option>
                        <option value="DPM2 Karras">DPM2 Karras</option>
                        <option value="DPM2 a Karras">DPM2 a Karras</option>
                        <option value="LMS Karras">LMS Karras</option>
                        <option value="DPM2 Karras">DPM2 Karras</option>
                        <option value="DPM++ 2S a Karras">DPM++ 2S a Karras</option>
                        <option value="DPM++ 2M Karras">DPM++ 2M Karras</option>
                        <option value="DPM++ 2M Karras">DPM++ 2M Karras</option>
                        <option value="DPM++ SDE Karras">DPM++ SDE Karras</option>
                        <option value="DDIM">DDIM</option>
                    </select>
                    <label class="form-check-label" for="sampler">Sampler</label>
                </div>
            </div>
        </div>
        <div class="my-2 row px-2">
            <!-- Width -->
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control" id="W" min="64" max="2048" value="512" step="64" placeholder="">
                    <label>Width</label>
                </div>
            </div>
            <!-- Height -->
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control" id="H" min="64" max="2048" value="512" step="64" placeholder="">
                    <label>Height</label>
                </div>
            </div>
            <!-- Seed -->
            <div class="col-3">
                <div class="form-floating">
                    <input type="number" class="form-control" id="seed" min="-1" value="-1" step="1" placeholder="">
                    <label>Seed</label>
                </div>
            </div>
            <!-- Steps -->
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control" id="steps" min="1" value="20" step="1" placeholder="">
                    <label>Steps</label>
                </div>
            </div>
            <!-- Seed Behavior -->
            <div class="col-3">
                <div class="form-floating mb-3">
                    <select class="form-select" id="seed_behavior">
                        <option value="iter">iter</option>
                        <option value="fixed" selected>fixed</option>
                        <option value="random">random</option>
                        <option value="schedule">schedule</option>
                    </select>
                    <label class="form-check-label" for="seed_behavior">Seed behavior</label>
                </div>
            </div>
        </div>
        <!-- Various Buttons -->
        <div class="my-2 row px-2">
            <div class="col d-grid">
                <input type="checkbox" class="btn-check" id="restore_faces" autocomplete="off">
                <label class="btn btn-outline-primary" for="restore_faces">Restore faces</label>
            </div>
            <div class="col d-grid">
                <input type="checkbox" class="btn-check" id="tiling" autocomplete="off">
                <label class="btn btn-outline-primary" for="tiling">Tiling</label>
            </div>
            <div class="col d-grid">
                <input type="checkbox" class="btn-check" id="Highres_fix" autocomplete="off">
                <label class="btn btn-outline-primary" for="Highres_fix">Highres. fix</label>
            </div>
            <div class="col d-grid">
                <input type="checkbox" class="btn-check" id="save_settings" autocomplete="off">
                <label class="btn btn-outline-primary" for="save_settings">Save settings</label>
            </div>
            <div class="col d-grid">
                <input type="checkbox" class="btn-check" id="save_sample" autocomplete="off">
                <label class="btn btn-outline-primary" for="save_sample">Save sample</label>
            </div>
        </div>
    </div>

    <!-- Prompt View -->
    <div class="view container-fluid pb-3" id="promptView" style="max-width: 900px;" onclick="">
        <!-- Prompt File Name Row -->
        <div class="pt-3 row">
            <div class="col">
                <div class="form-floating">
                    <textarea class="form-control" id="promptName" placeholder="" oninput="textAreaAutoExpand(this)" style="min-height: 58px;"></textarea>
                    <label for="promptName">File Name</label>
                </div>
            </div>
        </div>
        <!-- Frame Number Pattern Generator  -->
        <div class="pt-3 row">
            <div class="col-1 d-grid">
                <input type="checkbox" class="btn-check" id="autoPattern" autocomplete="off" onclick="changeButtonColorOnChecked(event)" checked>
                <label class="btn btn-danger my-auto" id="autoPatternLabel" for="autoPattern">Auto</label>
                <!-- <button class="btn btn-danger" id="autoPattern" onclick="changeButtonColorOnChecked(event)" checked>Auto</button> -->
            </div>
            <div class="col-3">
                <div class="form-floating">
                    <input type="number" min="0" step="1" class="form-control" value="30" id="frameNumberPattern">
                    <label>Frame number pattern</label>
                </div>
            </div>
            <div class="col d-grid">
                <button class="btn btn-success" onclick="reorderFrameNumber()">Apply pattern</button>
            </div>
            <div class="col">
                <div class="form-floating">
                    <input type="number" min="0" step="1" class="form-control" value="2" id="totalFrameNumber">
                    <label>Number of frames</label>
                </div>
            </div>
            <div class="col d-grid">
                <button class="btn btn-success" onclick="generateFramesAndReorder()">Apply number of frames</button>
            </div>
        </div>

        <!-- Static buttons row -->
        <div class="pt-3 row">
            <!-- Add blank keyframe -->
            <div class="col d-grid">
                <button class="btn btn-success btn bi-plus-circle" id="addBlankKeyframe" onclick="addKeyframeEnd('prompt')"> Add new keyframe</button>
            </div>
            <!-- Copy prompt to clipboard -->
            <div class="col d-grid">
                <button class="btn btn-primary btn bi-clipboard2-check" id="copyPrompt" onclick="copyPromptToClipboard()"> Copy prompt to clipboard</button>
            </div>
            <div class="col d-grid seedFlag d-none">
                <button class="btn btn-primary btn bi-clipboard2-check" id="copyPrompt" onclick="seedExport()"> Copy seed_schedule to clipboard</button>
            </div>
            <!-- Save prompt to file-->
            <div class="col d-grid">
                <button class="btn btn-primary btn bi-download" id="saveFile" onclick="savePromptToFile()"> Download prompt</button>
            </div>
        </div>

        <!-- Static Global Positive Prompt Row -->
        <div class="pt-3 row">
            <div class="col-9">
                <div class="form-floating">
                    <textarea class="form-control" id="globalPositivePrompt" placeholder="" oninput="textAreaAutoExpand(this)" style="min-height: 58px;"></textarea>
                    <label for="globalPositivePrompt">Global Positive Prompt</label>
                </div>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check globalButton" id="globalPositiveFirstButton" autocomplete="off" onclick="changeButtonColorOnChecked(event)">
                <label class="btn btn-secondary globalButton" id="globalPositiveFirstButtonLabel" for="globalPositiveFirstButton">Add before positive prompt</label>
                <!-- <button class="btn btn-secondary" id="globalPositiveFirstButton" onclick="changeButtonColorOnChecked(event)">Add before positive prompt</button> -->
            </div>
        </div>

        <!-- Static Global Negative Prompt Row -->
        <div class="pt-3 row">
            <div class="col-9">
                <div class="form-floating">
                    <textarea class="form-control" id="globalNegativePrompt" placeholder="" oninput="textAreaAutoExpand(this)" style="min-height: 58px;"></textarea>
                    <label for="globalNegativePrompt">Global Negative Prompt</label>
                </div>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check" id="globalNegativeFirstButton" autocomplete="off" value="True" onclick="changeButtonColorOnChecked(event)">
                <label class="btn btn-secondary globalButton" id="globalNegativeFirstButtonLabel" for="globalNegativeFirstButton">Add before negative prompt</label>
                <!-- <button class="btn btn-secondary" id="globalNegativeFirstButton" onclick="changeButtonColorOnChecked(event)">Add before negative prompt</button> -->
            </div>
        </div>

        <!-- Where all the keyframe are -->
        <div id="promptContainer"></div>
    </div>

    <!-- Keyframe Template -->
    <div class="mt-3 promptTemplate d-none" id="promptTemplate">
        <!-- First Row -->
        <div class="row pt-2 px-2 firstrow">
            <!-- Frame Number -->
            <div class="col-2">
                <div class="input-group-text eventNumber text-end">1</div>
            </div>
            <div class="col-8">
                <div class="btn-group">
                    <!-- Add New -->
                    <div class="input-group-text">New</div>
                    <!-- Start -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-up" onclick="addKeyframeStart('prompt')"></button>
                    <!-- Before -->
                    <button class="btn btn-success btn-sm bi-arrow-up" onclick="addKeyframeBefore(event, 'prompt')"></button>
                    <!-- After -->
                    <button class="btn btn-success btn-sm bi-arrow-down" onclick="addKeyframeAfter(event, 'prompt')"></button>
                    <!-- End -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-down" onclick="addKeyframeEnd('prompt')"></button>

                    <!-- Duplicate -->
                    <div class="input-group-text">Copy</div>
                    <!-- Duplicate Keyframe to Start -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-up" onclick="duplicateStart(event, 'prompt')"></button>
                    <!-- Duplicate Keyframe before -->
                    <button class="btn btn-success btn-sm bi-arrow-up" onclick="duplicateBefore(event, 'prompt')"></button>
                    <!-- Duplicate Keyframe to End -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-down" onclick="duplicateEnd(event, 'prompt')"></button>

                    <!-- Move -->
                    <div class="input-group-text">Move</div>
                    <!-- Move Start -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-up" onclick="moveStart(event, 'prompt')"></button>
                    <!-- Move Up -->
                    <button class="btn btn-success btn-sm bi-arrow-up" onclick="moveBefore(event, 'prompt')"></button>
                    <!-- Move Down -->
                    <button class="btn btn-success btn-sm bi-arrow-down" onclick="moveAfter(event, 'prompt')"></button>
                    <!-- Move End -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-down" onclick="moveEnd(event, 'prompt')"></button>
                </div>
            </div>

            <div class="col">
                <div class="btn-group">
                    <!-- Clear Frame Inputs -->
                    <button class="btn btn-danger bi-arrow-counterclockwise" onclick="resetFrame(event, 'prompt')"></button>
                    <!-- Delete Keyframe -->
                    <button class="btn btn-danger btn-sm bi-x-circle" onclick="deleteKeyframe(event, 'prompt')"></button>
                </div>
            </div>
        </div>
        <!-- Second Row -->
        <div class="my-2 row px-2 secondrow">
            <!-- frameNumber -->
            <div class="col-1">
                <button class="btn-secondary lock bi-unlock-fill" style="height: 58px; width:58px;" onclick="changeLockIcon(event)"></button>
            </div>
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control frameNumber" id="frameNumberField" min="0" value="0" placeholder="">
                    <label>Keyframe</label>
                </div>
            </div>
            <div class="col-2 seedFlag d-none">
                <div class="form-floating">
                    <input type="number" class="form-control seed" min="0" value="0" placeholder="">
                    <label>Seed</label>
                </div>
            </div>
            <!-- Negative Prompt -->
            <div class="col">
                <div class="form-floating">
                    <textarea class="form-control negativePrompt" placeholder="" oninput="textAreaAutoExpand(this)" style="min-height: 58px;" style="min-height: 58px;"></textarea>
                    <label>Negative Prompt</label>
                </div>
            </div>
        </div>
        <!-- Third Row -->
        <div class="my-2 row px-2 pb-2">
            <!-- Prompt -->
            <div class="col form">
                <div class="form-floating">
                    <textarea class="form-control positivePrompt" placeholder="" oninput="textAreaAutoExpand(this)" style="min-height: 58px;"></textarea>
                    <label class="form-label">Positive Prompt</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Motion View -->
    <div class="view container-fluid d-none" id="motionView" style="max-width: 900px;">
        <!-- Static Global Positive Prompt Row -->
        <div class="pt-3 row">
            <div class="col">
                <div class="form-floating">
                    <textarea class="form-control" id="promptName" placeholder="" oninput="textAreaAutoExpand(this)" style="min-height: 58px;"></textarea>
                    <label for="globalPositivePrompt">File Name</label>
                </div>
            </div>
        </div>
        <!-- Static buttons row -->
        <div class="pt-3 row">
            <!-- Add blank keyframe -->
            <div class="col d-grid">
                <button class="btn btn-success btn bi-plus-circle" id="addBlankKeyframe" onclick="addKeyframeEnd('motion')"> Add new keyframe</button>
            </div>
            <!-- Copy prompt to clipboard -->
            <div class="col d-grid">
                <button class="btn btn-primary btn" id="copyPrompt" onclick="copyPromptToClipboard()">Copy prompt to clipboard</button>
            </div>
            <!-- Save prompt to file-->
            <div class="col d-grid">
                <button class="btn btn-primary btn bi-download" id="saveFile" onclick="savePromptToFile()"></button>
            </div>
        </div>

        <!-- Where all the keyframe are -->
        <div id="motionContainer"></div>
    </div>

    <!-- Motion Keyframe Template -->
    <div class="my-3 d-none" id="motionTemplate" style="background-color:#3b3b3b;">
        <div class="row pt-2 px-2">
            <!-- Frame Number -->
            <div class="col-2">
                <!-- <div class="input-group-text eventNumber"> </div> -->
            </div>
            <div class="col">
                <div class="btn-group">
                    <!-- Add New -->
                    <div class="input-group-text">New</div>
                    <!-- Start -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-up" onclick="addKeyframeStart('motion')"></button>
                    <!-- Before -->
                    <button class="btn btn-success btn-sm bi-arrow-up" onclick="addKeyframeBefore(event, 'motion')"></button>
                    <!-- After -->
                    <button class="btn btn-success btn-sm bi-arrow-down" onclick="addKeyframeAfter(event, 'motion')"></button>
                    <!-- End -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-down" onclick="addKeyframeEnd('motion')"></button>

                    <!-- Duplicate -->
                    <div class="input-group-text">Copy</div>
                    <!-- Duplicate Keyframe to Start -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-up" onclick="duplicateKeyframe(event, 0,'motion')"></button>
                    <!-- Duplicate Keyframe before -->
                    <button class="btn btn-success btn-sm bi-arrow-up" onclick="duplicateKeyframe(event, 1, 'motion')"></button>
                    <!-- Duplicate Keyframe to End -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-down" onclick="duplicateKeyframe(event, 2, 'motion')"></button>

                    <!-- Move -->
                    <div class="input-group-text">Move</div>
                    <!-- Move Start -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-up" onclick="moveStart(event, 'motion')"></button>
                    <!-- Move Up -->
                    <button class="btn btn-success btn-sm bi-arrow-up" onclick="moveBefore(event, 'motion')"></button>
                    <!-- Move Down -->
                    <button class="btn btn-success btn-sm bi-arrow-down" onclick="moveAfter(event, 'motion')"></button>
                    <!-- Move End -->
                    <button class="btn btn-success btn-sm bi-arrow-bar-down" onclick="moveEnd(event, 'motion')"></button>
                </div>
            </div>
            <div class="col">
                <div class="btn-group">
                    <!-- Clear Frame Inputs -->
                    <button class="btn btn-danger bi-arrow-counterclockwise" onclick="resetFrame(event, 'motion')"></button>
                    <!-- Delete Keyframe -->
                    <button class="btn btn-danger btn-sm bi-x-circle" onclick="deleteKeyframe(event, 'motion')"></button>
                </div>
            </div>
        </div>
        <!-- Second Row -->
        <div class="my-2 row px-2">
            <div class="col">
                <div class="btn-group">
                    <!-- Translation -->
                    <input type="radio" class="btn-check motionType" name="motionType" id="translation" autocomplete="off" checked />
                    <label class="btn btn-outline-secondary" for="translation">Translation</label>
                    <!-- Rotation -->
                    <input type="radio" class="btn-check motionType" name="motionType" id="rotation" autocomplete="off" />
                    <label class="btn btn-outline-secondary" for="rotation">Rotation</label>
                    <!-- X Axis Button -->
                    <input type="radio" class="btn-check axis" name="axis" id="x" autocomplete="off" checked />
                    <label class="btn btn-outline-danger" for="x">X</label>
                    <!-- Y Axis Button -->
                    <input type="radio" class="btn-check axis" name="axis" id="y" autocomplete="off" />
                    <label class="btn btn-outline-info" for="y">Y</label>
                    <!-- Z Axis Button -->
                    <input type="radio" class="btn-check axis" name="axis" id="z" autocomplete="off" />
                    <label class="btn btn-outline-success" for="z">Z</label>
                </div>
            </div>

            <div class="col">
                <div class="btn-group">
                    <!-- Zoom -->
                    <input type="radio" class="btn-check motionType" name="motionType" id="zoom" autocomplete="off" />
                    <label class="btn btn-outline-secondary" for="zoom">Zoom</label>
                    <!-- Angle -->
                    <input type="radio" class="btn-check motionType" name="motionType" id="angle" autocomplete="off" />
                    <label class="btn btn-outline-secondary" for="angle">Angle</label>
                </div>
            </div>

            <!-- To frame -->
            <div class="col">
                <div class="btn-group">
                    <!-- To next keyframe -->
                    <input type="radio" class="btn-check axis" name="toFrame" id="next" autocomplete="off" checked />
                    <label class="btn btn-outline-success" for="next">Next</label>
                    <!-- To specific keyframe -->
                    <input type="radio" class="btn-check axis" name="toFrame" id="specific" autocomplete="off" />
                    <label class="btn btn-outline-danger" for="specific">Specific</label>
                    <!-- Span -->
                    <input type="radio" class="btn-check axis" name="toFrame" id="span" autocomplete="off" />
                    <label class="btn btn-outline-primary" for="span">Span</label>
                </div>
            </div>
        </div>

        <!-- Third Row -->
        <div class="my-2 row px-2 pb-2">
            <!-- Start Frame Number -->
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control span" min="0" value="0" placeholder="">
                    <label>Start</label>
                </div>
            </div>
            <!-- Specific Frame Input -->
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control span" min="0" value="1" placeholder="">
                    <label>End</label>
                </div>
            </div>
            <!-- Span Input -->
            <div class="col-2">
                <div class="form-floating">
                    <input type="number" class="form-control span" min="0" value="1" placeholder="">
                    <label>Span</label>
                </div>
            </div>
            <!-- Value -->
            <div class="col">
                <div class="form-floating">
                    <input type="text" class="form-control span" placeholder="">
                    <label>Value</label>
                </div>
            </div>
        </div>
    </div>

    <div class="view" id="aboutView"></div>

    <script type="module" src="./js/main.js" async defer></script>
    <script type="module" src="./js/sortable.esm.js"></script>
</body>

</html>